package net.prosavage.factionsx.listener

import net.prosavage.factionsx.disablePrinter
import net.prosavage.factionsx.isInPrinter
import net.prosavage.factionsx.util.getFPlayer
import org.bukkit.Material
import org.bukkit.entity.Player
import org.bukkit.event.EventHandler
import org.bukkit.event.Listener
import org.bukkit.event.entity.PlayerDeathEvent
import org.bukkit.event.inventory.ClickType
import org.bukkit.event.inventory.InventoryCreativeEvent
import org.bukkit.inventory.ItemStack

class PrinterExploitListener : Listener {
    @EventHandler
    fun onCreativeInventory(event: InventoryCreativeEvent) {
        if (event.click != ClickType.CREATIVE) return
        val fplayer = (event.whoClicked as Player).getFPlayer()
        if (!fplayer.isInPrinter()) return
        val cursorItemStack = event.cursor
        if (cursorItemStack.type == Material.AIR) return
        val itemstack = ItemStack(event.cursor.type, event.cursor.amount)
        itemstack.durability = event.cursor.durability
        event.cursor = itemstack
        fplayer.getPlayer()!!.updateInventory()
        if (cursorItemStack.enchantments.isEmpty()) return
        event.cursor = ItemStack(cursorItemStack.type, cursorItemStack.amount)
    }

    @EventHandler
    fun onDeath(event: PlayerDeathEvent) {
        val fplayer = event.entity.getFPlayer()
        if (fplayer.isInPrinter()) {
            fplayer.disablePrinter()
            event.drops.clear()
        }
    }


}